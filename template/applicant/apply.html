{% extends 'base.html' %}

{% block title %}Apply for {{ job.title }} - Job Portal{% endblock %}

{% block content %}
<div class="bg-gray-50 min-h-screen py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Breadcrumb -->
        <nav class="mb-8">
            <ol class="flex items-center space-x-2 text-sm text-gray-600">
                <li><a href="{% url 'home' %}" class="hover:text-primary">Home</a></li>
                <li><i class="fas fa-chevron-right text-xs"></i></li>
                <li><a href="{% url 'job_listings' %}" class="hover:text-primary">Jobs</a></li>
                <li><i class="fas fa-chevron-right text-xs"></i></li>
                <li><a href="{% url 'job_detail' job.id %}" class="hover:text-primary">{{ job.title }}</a></li>
                <li><i class="fas fa-chevron-right text-xs"></i></li>
                <li class="text-gray-900">Apply</li>
            </ol>
        </nav>

        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-4">Apply for {{ job.title }}</h1>
            <p class="text-gray-600">Complete your application for this position at {{ job.company_name }}</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Application Form -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-md p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Application Form</h2>
                    
                    <form method="POST" enctype="multipart/form-data" class="space-y-6">
                        {% csrf_token %}
                        
                        <!-- Cover Letter -->
                        <div>
                            <label for="cover_letter" class="block text-sm font-medium text-gray-700 mb-3">
                                Cover Letter <span class="text-red-500">*</span>
                            </label>
                            <div class="mb-2">
                                <p class="text-sm text-gray-600 mb-4">
                                    Write a compelling cover letter explaining why you're interested in this position and how your skills and experience make you a great fit.
                                </p>
                            </div>
                            <textarea id="cover_letter" name="cover_letter" rows="8" required
                                      class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"
                                      placeholder="Dear Hiring Manager,

I am writing to express my strong interest in the {{ job.title }} position at {{ job.company_name }}. 

[Your cover letter content here...]

Thank you for considering my application. I look forward to discussing how I can contribute to your team.

Best regards,
{{ user.get_full_name }}"></textarea>
                            <p class="mt-2 text-sm text-gray-500">
                                Minimum 100 characters. Be specific about why you want this role and what you can bring to the company.
                            </p>
                        </div>

                        <!-- Resume Upload -->
                        <div>
                            <label for="resume" class="block text-sm font-medium text-gray-700 mb-3">
                                Resume/CV
                            </label>
                            <div class="mb-2">
                                <p class="text-sm text-gray-600 mb-4">
                                    Upload your resume or CV. Accepted formats: PDF, DOC, DOCX (Max 5MB)
                                </p>
                            </div>
                            <div class="flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-primary transition duration-200">
                                <div class="space-y-1 text-center">
                                    <i class="fas fa-cloud-upload-alt text-gray-400 text-3xl mb-4"></i>
                                    <div class="flex text-sm text-gray-600">
                                        <label for="resume" class="relative cursor-pointer bg-white rounded-md font-medium text-primary hover:text-secondary focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-primary">
                                            <span>Upload a file</span>
                                            <input id="resume" name="resume" type="file" accept=".pdf,.doc,.docx" class="sr-only">
                                        </label>
                                        <p class="pl-1">or drag and drop</p>
                                    </div>
                                    <p class="text-xs text-gray-500">PDF, DOC, DOCX up to 5MB</p>
                                </div>
                            </div>
                            <div id="file-info" class="mt-2 text-sm text-gray-600 hidden">
                                <i class="fas fa-file-alt mr-2"></i>
                                <span id="file-name"></span>
                                <button type="button" id="remove-file" class="ml-2 text-red-500 hover:text-red-700">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Application Preview -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-sm font-semibold text-gray-700 mb-2">Application Preview</h3>
                            <div class="text-sm text-gray-600 space-y-1">
                                <p><strong>Job:</strong> {{ job.title }} at {{ job.company_name }}</p>
                                <p><strong>Applicant:</strong> {{ user.get_full_name }} ({{ user.email }})</p>
                                <p><strong>Application Date:</strong> {{ job.created_at|date:"M d, Y" }}</p>
                            </div>
                        </div>

                        <!-- Submit Buttons -->
                        <div class="flex justify-between items-center pt-6 border-t border-gray-200">
                            <a href="{% url 'job_detail' job.id %}" class="bg-gray-100 text-gray-700 px-6 py-2 rounded-lg font-semibold hover:bg-gray-200 transition duration-200 inline-flex items-center">
                                <i class="fas fa-arrow-left mr-2"></i>
                                Back to Job
                            </a>
                            <button type="submit" class="bg-primary text-white px-8 py-3 rounded-lg font-semibold hover:bg-secondary transition duration-200 inline-flex items-center">
                                <i class="fas fa-paper-plane mr-2"></i>
                                Submit Application
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Job Summary Sidebar -->
            <div class="lg:col-span-1">
                <!-- Job Details -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Job Details</h3>
                    <div class="space-y-3">
                        <div>
                            <h4 class="text-sm font-medium text-gray-700">{{ job.title }}</h4>
                            <p class="text-sm text-gray-600">{{ job.company_name }}</p>
                        </div>
                        <div class="flex items-center text-gray-600">
                            <i class="fas fa-map-marker-alt text-primary mr-3 w-4"></i>
                            <span class="text-sm">{{ job.location }}</span>
                        </div>
                        <div class="flex items-center text-gray-600">
                            <i class="fas fa-clock text-primary mr-3 w-4"></i>
                            <span class="text-sm">Posted {{ job.created_at|timesince }} ago</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <a href="{% url 'job_detail' job.id %}" class="text-primary hover:text-secondary font-semibold text-sm inline-flex items-center">
                            View Full Job Details
                            <i class="fas fa-arrow-right ml-1 text-xs"></i>
                        </a>
                    </div>
                </div>

                <!-- Application Tips -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Application Tips</h3>
                    <div class="space-y-3 text-sm text-gray-600">
                        <div class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mr-2 mt-0.5"></i>
                            <span>Customize your cover letter for this specific role</span>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mr-2 mt-0.5"></i>
                            <span>Highlight relevant experience and skills</span>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mr-2 mt-0.5"></i>
                            <span>Keep your resume updated and professional</span>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mr-2 mt-0.5"></i>
                            <span>Proofread your application before submitting</span>
                        </div>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Need Help?</h3>
                    <div class="space-y-3 text-sm text-gray-600">
                        <div class="flex items-center">
                            <i class="fas fa-envelope text-primary mr-3 w-4"></i>
                            <span>support@jobportal.com</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-phone text-primary mr-3 w-4"></i>
                            <span>+1 (555) 123-4567</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-clock text-primary mr-3 w-4"></i>
                            <span>Mon-Fri 9AM-6PM</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // File upload handling
    const fileInput = document.getElementById('resume');
    const fileInfo = document.getElementById('file-info');
    const fileName = document.getElementById('file-name');
    const removeFile = document.getElementById('remove-file');

    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            fileName.textContent = file.name;
            fileInfo.classList.remove('hidden');
        } else {
            fileInfo.classList.add('hidden');
        }
    });

    removeFile.addEventListener('click', function() {
        fileInput.value = '';
        fileInfo.classList.add('hidden');
    });

    // Drag and drop functionality
    const dropZone = fileInput.closest('.border-dashed');
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
        dropZone.classList.add('border-primary');
    }

    function unhighlight(e) {
        dropZone.classList.remove('border-primary');
    }

    dropZone.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        fileInput.files = files;
        
        if (files.length > 0) {
            fileName.textContent = files[0].name;
            fileInfo.classList.remove('hidden');
        }
    }
</script>
{% endblock %} 